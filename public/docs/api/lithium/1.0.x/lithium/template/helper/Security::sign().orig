<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8" />	<title>lithium\template\helper\Security::sign() – Framework API v1.0.x – Documentation – li3 PHP-Framework</title>
		<link rel="stylesheet" href="/assets/v:__PROJECT_VERSION_BUILD__xyzz/css/reset.css" />
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Anonymous+Pro:400,700,400italic,700italic" />
	<link rel="stylesheet" href="/assets/v:__PROJECT_VERSION_BUILD__xyzz/css/u1m.css" />
	<link rel="stylesheet" href="/assets/v:__PROJECT_VERSION_BUILD__xyzz/css/li3_docs.css" />
	<link rel="stylesheet" href="/assets/v:__PROJECT_VERSION_BUILD__xyzz/css/highlight.css" />
	
	
	<script src="//cdnjs.cloudflare.com/ajax/libs/require.js/2.1.10/require.min.js"></script>
	<script src="/assets/v:__PROJECT_VERSION_BUILD__xyzz/js/base.js"></script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/prism/0.0.1/prism.min.js"></script>
	
	
	<link rel="icon" href="/assets/ico/site.png">

		<script>
	  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	  ga('create', 'UA-11048416-4', 'auto');
	  ga('send', 'pageview');
	</script>
	</head>
<body class="layout-default li3-docs">
		<div id="container">
			<header class="main">
	<div class="left">
		<h1><a href="/" class="li3-logo">li3</a></h1>
	</div>
	<div class="right">
		<nav class="main-nav"><a href="http://news.li3.me">News</a><a href="/docs" class="active">Documentation</a><a href="/versions">Versions</a><a href="/present">Presentations</a><a href="/support">Community</a><a href="/development">Development</a></nav>	</div>
</header>							<nav class="crumbs">
	<ul itemscope itemtype="http://schema.org/BreadcrumbList">
			<li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
			<meta itemprop="position" content="1" />
							<a href="/docs" itemscope itemprop="item" itemtype="http://schema.org/Thing"><span itemprop="name">Documentation</span></a>
					</li>
			<li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
			<meta itemprop="position" content="2" />
							<a href="/docs/api/lithium/1.0.x/lithium" itemscope itemprop="item" itemtype="http://schema.org/Thing"><span itemprop="name">Framework API (1.0.x)</span></a>
					</li>
			<li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
			<meta itemprop="position" content="3" />
							<a href="/docs/api/lithium/1.0.x/lithium" itemscope itemprop="item" itemtype="http://schema.org/Thing"><span itemprop="name">lithium</span></a>
					</li>
			<li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
			<meta itemprop="position" content="4" />
							<a href="/docs/api/lithium/1.0.x/lithium/template" itemscope itemprop="item" itemtype="http://schema.org/Thing"><span itemprop="name">template</span></a>
					</li>
			<li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
			<meta itemprop="position" content="5" />
							<a href="/docs/api/lithium/1.0.x/lithium/template/helper" itemscope itemprop="item" itemtype="http://schema.org/Thing"><span itemprop="name">helper</span></a>
					</li>
			<li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
			<meta itemprop="position" content="6" />
							<a href="/docs/api/lithium/1.0.x/lithium/template/helper/Security" itemscope itemprop="item" itemtype="http://schema.org/Thing"><span itemprop="name">Security</span></a>
					</li>
			<li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
			<meta itemprop="position" content="7" />
							<span itemscope itemprop="item" itemtype="http://schema.org/Thing">
					<span itemprop="name">sign()</span>
				</span>
					</li>
		</ul>
</nav>						<div id="content">
				<article class="apis-view has-aside-right">

	<nav class="aside aside-right">
			<h3 class="h-gamma">Contents</h3>
		<ul>
			<li class="nav-up"><a href="/docs/api/lithium/1.0.x/lithium/template/helper/Security" rel="up">../</a>		</ul>
	
													
										</nav>
	<div class="body">
			<h1 class="h-alpha">
		<a href="/docs/api/lithium/1.0.x/lithium" class="symbol-segment">lithium</a>\<a href="/docs/api/lithium/1.0.x/lithium/template" class="symbol-segment">template</a>\<a href="/docs/api/lithium/1.0.x/lithium/template/helper" class="symbol-segment">helper</a>\<a href="/docs/api/lithium/1.0.x/lithium/template/helper/Security" class="symbol-segment">Security</a>::sign()		</h1>

		<section class="under">
															<div class="tags">
													<span class="tag public">public</span>
												<span class="tag">method</span>
			</div>
		</section>

					
			<section>
									<div class="summary">
						<p>Binds the <code>Security</code> helper to the <code>Form</code> helper to create a signature used to secure form
fields against tampering.</p>
					</div>
				
									<div class="description">
						<p>First <code>FormSignature</code> must be provided with a secret unique to your app. This is best
done in the bootstrap process. The secret key should be a random lengthy string.</p>
<pre><code class="language-php">use lithium\security\validation\FormSignature;
FormSignature::config(array('secret' =&gt; 'a long secret key'));
</code></pre>
<p>In the view call the <code>sign()</code> method before creating the form.</p>
<pre><code class="language-php">&lt;?php $this-&gt;security-&gt;sign(); ?&gt;
&lt;?=$this-&gt;form-&gt;create(...); ?&gt;
    // Form fields...
&lt;?=$this-&gt;form-&gt;end(); ?&gt;
</code></pre>
<p>In the corresponding controller action verify the signature.</p>
<pre><code class="language-php">if ($this-&gt;request-&gt;is('post') &amp;&amp; !FormSignature::check($this-&gt;request)) {
    // The key didn't match, meaning the request has been tampered with.
}
</code></pre>
<p>Calling this method before a form is created adds two additional options to the <code>$options</code>
parameter in all form inputs:</p>
<ul>
<li><p><code>'locked'</code> <em>boolean</em>: If <code>true</code>, <em>locks</em> the value specified in the field when the field
is generated, such that tampering with the value will invalidate the signature. Defaults
to <code>true</code> for hidden fields, and <code>false</code> for all other form inputs.</p>
</li>
<li><p><code>'exclude'</code> <em>boolean</em>: If <code>true</code>, this field and all subfields of the same name will be
excluded from the signature calculation. This is useful in situations where fields may be
added dynamically on the client side. Defaults to <code>false</code>.</p>
</li>
</ul>
					</div>
							</section>

						<section id="params">
				<h3 class="h-beta">Parameters</h3>
				<ul class="parameters">
											<li>
							<span class="type">object</span>
							<code class="name">$form</code>
															<span class="parameter">
									<p>Optional. Allows specifying an instance of the <code>Form</code> helper manually.</p>
								</span>
													</li>
									</ul>
			</section>
			
						<section id="return">
				<h3 class="h-beta">Returns</h3>
				<span class="type">void</span>
							</section>
			
			
						<section id="related">
				<h3 class="h-beta">Related</h3>
				<ul class="related">
									<li><a href="/docs/api/lithium/1.0.x/lithium/template/helper/Form">lithium\template\helper\Form</a>									<li><a href="/docs/api/lithium/1.0.x/lithium/security/validation/FormSignature">lithium\security\validation\FormSignature</a>								</ul>
			</section>
			
			
			
						<section id="source" class="section">
				<h3 class="h-beta">Source</h3>
				<div id="source" class="source-display">
					<div class="source-wrapper">
						<pre class="source-code"><code class="language-php">	public function sign($form = null) {
		$state =&amp; $this-&gt;_state;
		$classes = $this-&gt;_classes;
		$form = $form ?: $this-&gt;_context-&gt;form;
		$id = spl_object_hash($form);
		$hasBound = isset($state[$id]);

		if ($hasBound) {
			return;
		}

		$form-&gt;applyFilter(&#039;create&#039;, function($self, $params, $chain) use ($form, &amp;$state) {
			$id = spl_object_hash($form);
			$state[$id] = array(&#039;fields&#039; =&gt; array(), &#039;locked&#039; =&gt; array(), &#039;excluded&#039; =&gt; array());
			return $chain-&gt;next($self, $params, $chain);
		});

		$form-&gt;applyFilter(&#039;end&#039;, function($self, $params, $chain) use ($form, &amp;$state, $classes) {
			$id = spl_object_hash($form);

			if (!$state[$id]) {
				return $chain-&gt;next($self, $params, $chain);
			}
			$value = $classes[&#039;formSignature&#039;]::key($state[$id]);
			echo $form-&gt;hidden(&#039;security.signature&#039;, compact(&#039;value&#039;));

			$state[$id] = array();
			return $chain-&gt;next($self, $params, $chain);
		});

		$form-&gt;applyFilter(&#039;_defaults&#039;, function($self, $params, $chain) use ($form, &amp;$state) {
			$defaults = array(
				&#039;locked&#039; =&gt; ($params[&#039;method&#039;] === &#039;hidden&#039; &amp;&amp; $params[&#039;name&#039;] !== &#039;_method&#039;),
				&#039;exclude&#039; =&gt; $params[&#039;name&#039;] === &#039;_method&#039;
			);
			$options = $params[&#039;options&#039;];

			$options += $defaults;
			$params[&#039;options&#039;] = array_diff_key($options, $defaults);
			$result = $chain-&gt;next($self, $params, $chain);

			if ($params[&#039;method&#039;] === &#039;label&#039;) {
				return $result;
			}
			$value = isset($params[&#039;options&#039;][&#039;value&#039;]) ? $params[&#039;options&#039;][&#039;value&#039;] : &quot;&quot;;

			$type = array(
				$options[&#039;exclude&#039;]  =&gt; &#039;excluded&#039;,
				!$options[&#039;exclude&#039;] =&gt; &#039;fields&#039;,
				$options[&#039;locked&#039;]   =&gt; &#039;locked&#039;
			);
			if (!$name = preg_replace(&#039;/(\.\d+)+$/&#039;, &#039;&#039;, $params[&#039;name&#039;])) {
				return $result;
			}
			$state[spl_object_hash($form)][$type[true]][$name] = $value;
			return $result;
		});
	}</code></pre>
					</div>
				</div>
			</section>
							</div>
	</article>			</div>
		</div>
		<footer class="main">
	<div class="area"></div>
	<div class="area"></div>
	<div class="area"></div>
	<div class="area"></div>

	<div class="social">
		<a href="https://github.com/unionofrad" target="new">GitHub</a>		<span class="separator">/</span>
		<a href="https://twitter.com/unionofrad" target="new">Twitter</a>		<span class="separator">/</span>
		<a href="http://www.reddit.com/r/li3" target="new">Reddit</a>		<span class="separator">/</span>
		<a href="https://stackoverflow.com/questions/tagged/lithium" target="new">Stack Overflow</a>	</div>
	<div class="testimonial">
		<img src="/assets/v:__PROJECT_VERSION_BUILD__xyzz/img/testimonials/10.png" alt="Testimonial Image" />		<p>I think it's time you started<br />
writing better code.</p>
	</div>
	<div class="copyright">
		Pretty much everything is (c) 2009-2024 and beyond, the <a href="http://unionofrad.org">Union of RAD</a>.	</div>
</footer>	</body>
</body>
</html>

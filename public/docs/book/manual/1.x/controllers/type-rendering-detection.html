<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8" />	<title>Type Rendering Detection – li₃: The Definitive Guide v1.x – Documentation – li3 PHP-Framework</title>
		<link rel="stylesheet" href="../../../../../assets/v:__PROJECT_VERSION_BUILD__xyzz/css/reset.css" />
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Anonymous+Pro:400,700,400italic,700italic" />
	<link rel="stylesheet" href="../../../../../assets/v:__PROJECT_VERSION_BUILD__xyzz/css/u1m.css" />
	<link rel="stylesheet" href="../../../../../assets/v:__PROJECT_VERSION_BUILD__xyzz/css/li3_docs.css" />
	<link rel="stylesheet" href="../../../../../assets/v:__PROJECT_VERSION_BUILD__xyzz/css/highlight.css" />
	
	
	<script src="http://cdnjs.cloudflare.com/ajax/libs/require.js/2.1.10/require.min.js"></script>
	<script src="../../../../../assets/v:__PROJECT_VERSION_BUILD__xyzz/js/base.js"></script>
	<script src="http://cdnjs.cloudflare.com/ajax/libs/prism/0.0.1/prism.min.js"></script>
	
	
	<link rel="icon" href="../../../../../assets/ico/site.png">

		<script>
	  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	  ga('create', 'UA-11048416-4', 'auto');
	  ga('send', 'pageview');
	</script>
	</head>
<body class="layout-default li3-docs">
		<div id="container">
			<header class="main">
	<div class="left">
		<h1><a href="../../../../../index.html" class="li3-logo">li3</a></h1>
	</div>
	<div class="right">
		<nav class="main-nav"><a href="http://news.li3.me">News</a><a href="../../../../../docs.html" class="active">Documentation</a><a href="../../../../../versions.html">Versions</a><a href="../../../../../present.html">Presentations</a><a href="../../../../../support.html">Community</a><a href="../../../../../development.html">Development</a></nav>	</div>
</header>							<nav class="crumbs">
	<ul itemscope itemtype="http://schema.org/BreadcrumbList">
			<li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
			<meta itemprop="position" content="1" />
							<a href="../../../../../docs.html" itemscope itemprop="item" itemtype="http://schema.org/Thing"><span itemprop="name">Documentation</span></a>
					</li>
			<li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
			<meta itemprop="position" content="2" />
							<a href="../../1.x.html" itemscope itemprop="item" itemtype="http://schema.org/Thing"><span itemprop="name">li₃: The Definitive Guide (1.x)</span></a>
					</li>
			<li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
			<meta itemprop="position" content="3" />
							<a href="../controllers.html" itemscope itemprop="item" itemtype="http://schema.org/Thing"><span itemprop="name">Controllers</span></a>
					</li>
			<li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
			<meta itemprop="position" content="4" />
							<span itemscope itemprop="item" itemtype="http://schema.org/Thing">
					<span itemprop="name">Type Rendering Detection</span>
				</span>
					</li>
		</ul>
</nav>						<div id="content">
				<article class="books-view has-aside-right">
	<nav class="aside aside-right">
		<h3 class="h-gamma">Contents</h3>
		<ul><li><a href="../common-tasks.html" class="">Common Tasks</a><ul><li><a href="../common-tasks/logging.html" class="">Logging</a><li><a href="../common-tasks/plugins.html" class="">Plugins</a><li><a href="../common-tasks/error-handling.html" class="">Error Handling</a><li><a href="../common-tasks/caching.html" class="">Caching</a><li><a href="../common-tasks/filters.html" class="">Filters</a><li><a href="../common-tasks/etags.html" class="">Etags</a><li><a href="../common-tasks/globalization.html" class="">Globalization</a><li><a href="../common-tasks/simple-authentication.html" class="">Simple Authentication</a><li><a href="../common-tasks/simple-auth-user.html" class="">Simple Auth User</a><li><a href="../common-tasks/console-applications.html" class="">Console Applications</a></ul><li><a href="../appendices.html" class="">Appendices</a><ul><li><a href="../appendices/faqs.html" class="">FAQs</a><li><a href="../appendices/using-in-other-applications.html" class="">Using In Other Applications</a></ul><li><a href="../quickstart.html" class="">Quickstart</a><li><a href="../controllers.html" class="">Controllers</a><ul><li><a href="actions.html" class="">Actions</a><li><a href="flow-control.html" class="">Flow Control</a><li><a href="parameters.html" class="">Parameters</a><li><a href="type-rendering-detection.html" class="active">Type Rendering Detection</a><li><a href="routing.html" class="">Routing</a></ul><li><a href="../installation.html" class="">Installation</a><ul><li><a href="../installation/requirements.html" class="">Requirements</a><li><a href="../installation/troubleshooting.html" class="">Troubleshooting</a><li><a href="../installation/web-servers.html" class="">Web Servers</a></ul><li><a href="../architecture.html" class="">Architecture</a><ul><li><a href="../architecture/file-structure.html" class="">File Structure</a><li><a href="../architecture/response-lifecycle.html" class="">Response Lifecycle</a><li><a href="../architecture/aop.html" class="">AOP</a><li><a href="../architecture/mvc.html" class="">MVC</a><li><a href="../architecture/objects.html" class="">Objects</a></ul><li><a href="../quality-code.html" class="">Quality Code</a><ul><li><a href="../quality-code/fixtures.html" class="">Fixtures</a><li><a href="../quality-code/analysis.html" class="">Analysis</a><li><a href="../../../../manual/quality-code/testing.wiki.html" class="">Testing</a><li><a href="../quality-code/security.html" class="">Security</a></ul><li><a href="../configuration.html" class="">Configuration</a><ul><li><a href="../configuration/environment.html" class="">Environment</a><li><a href="../configuration/bootstrapping.html" class="">Bootstrapping</a><li><a href="../configuration/third-party-libraries.html" class="">Third Party Libraries</a></ul><li><a href="../views.html" class="">Views</a><ul><li><a href="../views/layouts.html" class="">Layouts</a><li><a href="../views/elements.html" class="">Elements</a><li><a href="../views/helpers.html" class="">Helpers</a><li><a href="../views/static-content.html" class="">Static Content</a><li><a href="../views/auto-escaping.html" class="">Auto Escaping</a></ul><li><a href="../models.html" class="">Models</a><ul><li><a href="../models/mongodb.html" class="">Mongodb</a><li><a href="../models/meta.html" class="">Meta</a><li><a href="../models/relationships.html" class="">Relationships</a><li><a href="../models/saving.html" class="">Saving</a><li><a href="../models/using-data-sources.html" class="">Using Data Sources</a><li><a href="../models/adding-functions.html" class="">Adding Functions</a><li><a href="../models/data-mutation.html" class="">Data Mutation</a><li><a href="../models/connections.html" class="">Connections</a><li><a href="../models/creating-data-sources.html" class="">Creating Data Sources</a><li><a href="../models/querying.html" class="">Querying</a><li><a href="../models/validation.html" class="">Validation</a></ul></ul>	</nav>
	<div class="body">
		<h1><a id="type-rendering-and-detection" class="anchor" href="type-rendering-detection.html#type-rendering-and-detection">Type Rendering and Detection</a></h1>
<p>Although a typical request to a li3 application receives an HTML response, the framework is built to be extremely flexible in handling and serving different types of content. This functionality is especially important in applications that have many different components or endpoints. If your app also feeds data to a Flash object (AMF/XML) and a mobile phone (XML/JSON), responding to requests in different ways with the same underlying logic can be a huge time saver.</p>
<p>The flow for handling a given type of a response works something like the following:</p>
<ol>
<li>A request is sent to the application, containing some sort of indicator of the request type. li3's default routing allows for simple extension detection, for example.</li>
<li>As li3 bootstraps, a media type and handler is registered with the <code>\net\http\Media</code> class.</li>
<li>The application detects the request type and sets the response type.</li>
<li>Once a controller is ready to render the data, the registered handler receives the data and renders the output.</li>
</ol>
<h2><a id="detecting-and-setting-types" class="anchor" href="type-rendering-detection.html#detecting-and-setting-types">Detecting and Setting Types</a></h2>
<p>The easiest way to set a type is by declaring it as part of the route. One of li3's default routes already does this for you:</p>
<pre><code class="language-php">Router::connect('/{:controller}/{:action}/{:id:[0-9]+}.{:type}', ['id' =&gt; null]);
</code></pre>
<div class="note note-info">
	<p>
	 You will need to uncomment the appropriate default route in the application folder's <code>/config/routes.php</code> file in order to use the features described below.  There are preformatted routes for both document type data sources and relational database sources available in the <code>routes.php</code> file.
	</p>
	<p>
	In effect, this forces a request to <code>/controller/action/7345.json</code> to be rendered by the JSON media handler currently registered. You can use this pattern to expand your routes to apply type-matching to a wider array of requests:
	</p>
</div>
<pre><code class="language-php">// http://example.com/controller/action.xml
Router::connect('/{:controller}/{:action}.{:type}');
</code></pre>
<h3><a id="example" class="anchor" href="type-rendering-detection.html#example">Example</a></h3>
<p>Let's assume that you are using a MySQL database as a datasource and you are retrieving data from the <code>blog_posts</code> table.  First, we need to enable the routes in the <code>routes.php</code> file as shown below:</p>
<pre><code class="language-php">/**
 * ### Database object routes
 *
 * The routes below are used primarily for accessing database objects, where `{:id}` corresponds to
 * the primary key of the database object, and can be accessed in the controller as
 * `$this-&gt;request-&gt;id`.
 *
 * If you're using a relational database, such as MySQL, SQLite or Postgres, where the primary key
 * is an integer, uncomment the routes below to enable URLs like `/posts/edit/1138`,
 * `/posts/view/1138.json`, etc.
 */
Router::connect('/{:controller}/{:action}/{:id:\d+}.{:type}', ['id' =&gt; null]);
Router::connect('/{:controller}/{:action}/{:id:\d+}');
</code></pre>
<p>Next, let's assume that there is already a view created to display the blog post at <code>views/blogposts/view.html.php</code>.  This means that when the controller's <code>view()</code> method is called, the aforementioned html view will be loaded.</p>
<p>In our controller, we can use the automatically generated <code>view()</code> method, provided you used the CLI to create the controller, which will get the id of the post from the URL.  If you didn't use the CLI to create the controller, then your view method should look something like this:</p>
<pre><code class="language-php">public function view() {
    $purchaseorder = PoHeader::find($this-&gt;request-&gt;id);
   	return compact('purchaseorder');
}
</code></pre>
<p>With these pieces in place, pointing the browser to <code>blogposts/view/1</code> will retrieve the blog post with id of 1 and render it into an HTML view, exactly as you expect.  If, however, you wish to render the same content in JSON as part of an API or other REST type application, then you can simply point the browser to <code>blogposts/view/1.json</code> and the data for the blog post will be rendered to the browser in a JSON format.   This is a very powerful feature as it allows you to develop a single controller method that can be quickly output into a variety of formats with very little effort.</p>
<h2><a id="other-ways-to-change-the-render-type" class="anchor" href="type-rendering-detection.html#other-ways-to-change-the-render-type">Other Ways to Change The Render Type</a></h2>
<p>You can also statically define the type for a route by adding the 'type' key to the route definition:</p>
<pre><code class="language-php">Router::connect('/latest/feed', [
	'Posts::index',
	'type' =&gt; 'xml'
]);
</code></pre>
<p>If you'd rather use other information to convey the request type to li3 (headers, GET variables, etc.) you can gather that information then set <code>$this-&gt;_render['type']</code> in the controller action.</p>
<p>Manual type rendering can also be done by handing the type's name to the render function:</p>
<pre><code class="language-php">$this-&gt;render(['csv' =&gt; Post::find('all')]);
</code></pre>
<h2><a id="handler-registration" class="anchor" href="type-rendering-detection.html#handler-registration">Handler Registration</a></h2>
<p>As mentioned earlier, type handlers are registered by the <code>\net\http\Media</code> class. This is usually done in the <code>/config/bootstrap/media.php</code> bootstrap file. Be sure to uncomment the corresponding line in the main bootstrap file to enable this functionality.</p>
<p>Register your type by passing the relevant information to <code>Media::type()</code> inside the bootstrap. Here's what the general pattern looks like:</p>
<pre><code class="language-php">Media::type('typeName', 'contentType', [$options]);
</code></pre>
<p>To give you an idea of how this process is completed, let's register a new handler for the BSON data type. If you're curious, BSON is a binary, serialized form of JSON used by MongoDB. Start by declaring a new media type in <code>/config/boostrap/media.php</code> and uncommenting the <code>media.php</code> line in your main bootstrap file:</p>
<pre><code class="language-php">Media::type('bson', 'application/bson', []);
</code></pre>
<p>This gets us pretty far. If you make a request with a .bson extension that matches a configured route (one with {:type} in it), li3 will already hunt for a <code>.bson.php</code> template in the controller's template directory. You can continue to customize li3's behavior by utilizing the <code>$options</code> array you supply to <code>Media::type()</code>. After checking the API docs for <code>Media::type()</code>, we realize we can utilize a few options to make sure our response isn't housed in an HTML layout and use some functions we've defined for encoding and decoding the data:</p>
<pre><code class="language-php">Media::type('bson', 'application/bson', [
	'layout' =&gt; false,
	'encode' =&gt; 'bson_encode',
	'decode' =&gt; 'bson_decode'
]);
</code></pre>
<p>Try the request again, and you'll get your BSON-encoded data, minus the HTML layout. Note that the bson_* functions used in this particular example are part of the PECL MongoDB extension. Don't worry if you don't have it installed: the main point is to realize that you can tell <code>Media</code> exactly what function to use to render the data (including using closures).</p>
<p>For more ideas on configuring media types, see the documentation for <code>Media::type()</code>.</p>
	</div>
</article>			</div>
		</div>
		<footer class="main">
	<div class="area"></div>
	<div class="area"></div>
	<div class="area"></div>
	<div class="area"></div>

	<div class="social">
		<a href="https://github.com/unionofrad" target="new">GitHub</a>		<span class="separator">/</span>
		<a href="https://twitter.com/unionofrad" target="new">Twitter</a>		<span class="separator">/</span>
		<a href="http://www.reddit.com/r/li3" target="new">Reddit</a>		<span class="separator">/</span>
		<a href="https://stackoverflow.com/questions/tagged/lithium" target="new">Stack Overflow</a>	</div>
	<div class="testimonial">
		<img src="../../../../../assets/v:__PROJECT_VERSION_BUILD__xyzz/img/testimonials/10.png" alt="Testimonial Image" />		<p>I think it's time you started<br />
writing better code.</p>
	</div>
	<div class="copyright">
		Pretty much everything is (c) 2009-2024 and beyond, the <a href="http://unionofrad.org">Union of RAD</a>.	</div>
</footer>	</body>
</body>
</html>
